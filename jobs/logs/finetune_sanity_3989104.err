/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/mmcv/cnn/bricks/transformer.py:32: UserWarning: Fail to import ``MultiScaleDeformableAttention`` from ``mmcv.ops.multi_scale_deform_attn``, You should install ``mmcv-full`` if you need this module. 
  warnings.warn('Fail to import ``MultiScaleDeformableAttention`` from '
wandb: [wandb.login()] Loaded credentials for https://api.wandb.ai from WANDB_API_KEY.
wandb: Currently logged in as: winnerabula55 (winnerabula55-khalifa-university) to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
wandb: setting up run yclx3wpw
wandb: Tracking run with wandb version 0.24.2
wandb: Run data is saved locally in /dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/wandb/run-20260210_122535-yclx3wpw
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run volcanic-lake-8
wandb: ‚≠êÔ∏è View project at https://wandb.ai/winnerabula55-khalifa-university/LoRA_resisc45_sanity
wandb: üöÄ View run at https://wandb.ai/winnerabula55-khalifa-university/LoRA_resisc45_sanity/runs/yclx3wpw
/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/functional.py:554: UserWarning: torch.meshgrid: in an upcoming release, it will be required to pass the indexing argument. (Triggered internally at /pytorch/aten/src/ATen/native/TensorShape.cpp:4322.)
  return _VF.meshgrid(tensors, **kwargs)  # type: ignore[attr-defined]
Train:   0%|          | 0/50 [00:00<?, ?it/s]                                             Traceback (most recent call last):
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/train_resisc45_lora.py", line 81, in <module>
    train_loss, train_acc = train_one_epoch(model, train_loader, optimizer, criterion, device)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/train_resisc45_lora.py", line 23, in train_one_epoch
    logits = model(x)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/skysense_lora_classifier_qkv.py", line 13, in forward
    feats = self.backbone(x)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/models/swin_transformer_v2.py", line 485, in forward
    x, hw_shape = stage(x, hw_shape)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/models/swin_transformer_v2.py", line 222, in forward
    x = block(x, out_shape)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/models/swin_transformer_v2.py", line 125, in forward
    x = _inner_forward(x)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/models/swin_transformer_v2.py", line 113, in _inner_forward
    x = self.ffn(x)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/mmcv/utils/misc.py", line 340, in new_func
    output = old_func(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/mmcv/cnn/bricks/transformer.py", line 622, in forward
    out = self.layers(x)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/container.py", line 244, in forward
    input = module(input)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/container.py", line 244, in forward
    input = module(input)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/peft/tuners/lora/layer.py", line 771, in forward
    result = result + lora_B(lora_A(dropout(x))) * scaling
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 270.00 MiB. GPU 0 has a total capacity of 31.73 GiB of which 232.19 MiB is free. Including non-PyTorch memory, this process has 31.50 GiB memory in use. Of the allocated memory 30.21 GiB is allocated by PyTorch, and 951.73 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
Traceback (most recent call last):
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/train_resisc45_lora.py", line 81, in <module>
    train_loss, train_acc = train_one_epoch(model, train_loader, optimizer, criterion, device)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/train_resisc45_lora.py", line 23, in train_one_epoch
    logits = model(x)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/skysense_lora_classifier_qkv.py", line 13, in forward
    feats = self.backbone(x)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/models/swin_transformer_v2.py", line 485, in forward
    x, hw_shape = stage(x, hw_shape)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/models/swin_transformer_v2.py", line 222, in forward
    x = block(x, out_shape)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/models/swin_transformer_v2.py", line 125, in forward
    x = _inner_forward(x)
  File "/dpc/kuin0137/LoRA_Experiment/classification/Updated_Vanilla/Skysense_FoundationModel_Finetuning/models/swin_transformer_v2.py", line 113, in _inner_forward
    x = self.ffn(x)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/mmcv/utils/misc.py", line 340, in new_func
    output = old_func(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/mmcv/cnn/bricks/transformer.py", line 622, in forward
    out = self.layers(x)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/container.py", line 244, in forward
    input = module(input)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/container.py", line 244, in forward
    input = module(input)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/kunet.ae/100066896/.local/lib/python3.9/site-packages/peft/tuners/lora/layer.py", line 771, in forward
    result = result + lora_B(lora_A(dropout(x))) * scaling
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 270.00 MiB. GPU 0 has a total capacity of 31.73 GiB of which 232.19 MiB is free. Including non-PyTorch memory, this process has 31.50 GiB memory in use. Of the allocated memory 30.21 GiB is allocated by PyTorch, and 951.73 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
srun: error: gpu-11-3: task 0: Exited with exit code 1
